#!/bin/bash

set -e

input_file=$1
bni_file=$(basename "$input_file")
tmp_pdf="${bni_file%.*}.pdf"
tmp_txt="${bni_file%.*}.txt"

# echo "--- ${TMPDIR} ---"

echo "$$ $(date)" >>/tmp/_sgf.log
echo "$$ $(pwd)"  >>/tmp/_sgf.log
echo "$$ $*" >>/tmp/_sgf.log

td=$(mktemp -d)
cp "$input_file" "$td"
pushd $td >>/tmp/sgf.log

# The most idiotic way I guess, but for me it was the only one working
soffice --headless --convert-to pdf "$bni_file" 2>>/tmp/_sgf.log 1>&2
pdftotext -layout "$tmp_pdf" "$tmp_txt" 2>>/tmp/_sgf.log 1>&2
cat "$tmp_txt"

# set +e
# rm $tmp_pdf $tmp_txt

popd
rm -rf "$td"

echo '$$ -------------------------' >>/tmp/_sgf.log
